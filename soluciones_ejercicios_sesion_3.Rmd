---
title: "Solución ejercicios - Sesión 3"
subtitle: "Capacitación en R"
author: "Capacitadores DET, en base a PE SCPE"
output: pdf_document
header-includes:
- \usepackage[fontsize=11.8pt]{scrextend}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Pasos previos

## Paquetes

```{r, message=FALSE}
## Se cargan los paquetes necesarios para la actividad
library(tidyverse)
```

## Base de datos

Importar la base [**ene-2019-11.csv**](https://www.ine.cl/docs/default-source/ocupacion-y-desocupacion/bbdd/2019/formato-csv/ene-2019-11.csv?sfvrsn=6f231878_6&download=true). 

```{r}
## La base se descarga y se guarda en la carpeta de "inputs" llamada "data" 
ene <- read.csv(file = "data/ene-2019-11.csv")
```

*El ejercicio no es del todo correcto si la lectura de la base solo funciona desde la computadora de quien hizo la tarea.*


Las siguientes tareas realicelas sobre la base ene.

# Ejercicio 1

Generar un cuadro de resumen que muestre en las filas la categoría de rama de actividad económica (**b14_rev4cl_canes**) y en las columnas los grupos ocupacionales (**b1**).

```{r}
# Se agrupa por las dos variables, generando conteo
ej1 <- ene %>%
  group_by(b14_rev4cl_caenes, b1) %>% 
  count()

## Se previsualiza el objeto
ej1 %>% 
  head(10)

# Se aplica pivet_wider() a objeto cuadro
ej1 <- ej1 %>% 
  pivot_wider(names_from = b14_rev4cl_caenes,
                      names_prefix = "b1_" ,
                       values_from = n) 

## Se despliega el objeto
ej1
```

# Ejercicio 2

Cree las siguientes variables:

+ **pet**: que tome valor 1 si edad es mayor o igual a 15, y 0 en otro caso.

```{r}
## Se observa distribución de variable
table(ene$edad, useNA = "ifany")

## Se recodifica con mutate() e if_else()
ej2 <- ene %>% 
  mutate(pet=if_else(edad>=15,1,0)) 

## Se despliega la tabla
table(ej2$pet, useNA = "ifany")
```

+ **ocu**: que tome el valor 1 si la variable cae_especifico se encuentra en el rango (extremos incluidos) entre 1 y 7, y que tome el valor 0 en cualquier otro caso.

```{r}
## Se observa distribución de variable
table(ej2$cae_especifico, useNA = "ifany")

## Se recodifica con mutate() y case_when(), para variar
ej2 <- ej2 %>% 
  mutate(ocu=case_when(cae_especifico>=1 & cae_especifico<=7 ~ 1,
                       TRUE~0))

## Se despliega la tabla
table(ej2$ocu, useNA = "ifany")
```

# Ejercicio 3

Genere un cuadro de resumen agrupado por región que muestre el total de la variable **pet** y el total de la variable **ocu**.

```{r, message=FALSE}

## Se agrupa según variable
ej3 <- ej2 %>% 
  group_by(region) %>%
  summarise(pet_total = sum(pet),
            ocu_total = sum(ocu)) %>% 
  select(region, pet_total, ocu_total)

## Se despliega el objeto
ej3
```

# Ejercicio 4

Sobre el cuadro de resumen del punto anterior, cree la variable **to**, que tomará el valor de: total de ocu / total de pet * 100

```{r,  message=FALSE}
## Se crea la nueva variable
ej4 = ej3 %>% 
  mutate(to = ocu_total/pet_total*100)

## Se despliega el objeto
ej4
```

*De esta forma se obtiene la tasa de ocupación, pero no será equivalente a la oficial pues no se están considerando los factores de expansión.*

# Sobre el envío

Enviar a más tardar el día jueves 17 de diciembre a las 17:00. Los ejercicios se deben enviar como archivo .R (script) con nombre y apellido de quien hizo la tarea a los correos `nicolas.ratto@ine.cl` y `gonzalo.franetovic@ine.cl`.